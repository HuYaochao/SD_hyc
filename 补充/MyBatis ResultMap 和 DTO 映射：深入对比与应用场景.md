### MyBatis ResultMap 和 DTO 映射：深入对比与应用场景

在使用 MyBatis 进行对象关系映射（ORM）时，开发者通常会面临选择：使用 `<resultMap>` 进行手动映射，还是通过直接映射到 DTO 类。这篇博客将详细讨论这两种方式的优缺点，并为不同的应用场景提供最佳实践建议。

#### 一、概述

| **映射方式**                    | **简介**                                                                                          | **优点**                                                                                      | **缺点**                                                                                          | **适用场景**                                |
|---------------------------------|---------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------|---------------------------------------------|
| **ResultMap 映射**              | 通过 `<resultMap>` 手动定义 Java 对象属性与数据库列的映射。                                          | 高度灵活，可处理复杂映射，避免了 DTO 类的创建。                                                   | 代码较复杂，难以维护，尤其是当映射逻辑复杂时。                                                             | 复杂的数据库表关系、需要灵活处理的场景       |
| **DTO 直接映射**                | 将 SQL 查询结果直接映射到预先定义好的数据传输对象（DTO）。                                          | 代码简单易读，便于维护，适用于简单查询。                                                        | 需要为每个查询创建 DTO 类，可能导致类爆炸。                                                                 | 简单的查询和结果处理，不涉及复杂映射的场景    |

#### 二、详细对比与应用场景

##### 1. ResultMap 映射

ResultMap 是 MyBatis 中一种常见的手动映射方式，它允许开发者定义一个复杂的映射规则，以处理数据库表之间的关系。这种方式非常灵活，适用于处理复杂的数据库查询结果，例如多个表的联合查询，或者需要处理嵌套对象时。

**示例分析：**
```xml
<resultMap id="OrderUserMap" type="order" autoMapping="true">
    <id column="order_id" property="id"/>
    <result column="create_time" property="creatTime"/>
    <result column="user_id" property="userId"/>
    <association property="user" javaType="user" autoMapping="true">
        <id column="user_id" property="id"/>
        <result column="username" property="username"/>
        <result column="password" property="password"/>
    </association>
</resultMap>
```

**优点：**
- **灵活性高**：可以处理复杂的表关系和嵌套映射，甚至可以映射到多个嵌套对象。
- **避免 DTO 爆炸**：对于复杂查询，可以通过 ResultMap 来避免创建大量 DTO 类。

**缺点：**
- **复杂性**：对于新手或团队协作来说，ResultMap 的配置可能较为复杂和难以理解。
- **维护难度**：随着系统复杂度的增加，ResultMap 的配置也会变得越来越难以维护。

**应用场景：**
- 适用于复杂的数据库表关系（例如一对多、多对多关系）。
- 需要将数据库结果映射到嵌套对象时（例如订单与用户信息的联合查询）。

##### 2. DTO 直接映射

DTO（数据传输对象）直接映射是一种更加简单和直接的映射方式，通常用于简单的查询场景。开发者可以将查询结果直接映射到一个 DTO 类，而无需手动定义复杂的映射规则。

**示例分析：**
```xml
<select id="findOrdersWithUser3" resultType="org.company.mybatisdemo.dto.OrderUserDTO">
    SELECT
           u.`username`,
           u.`password`,
           o.id order_id,
           o.create_time,
           o.user_id
    FROM `order` AS o,
         `user` AS u
    WHERE o.user_id = u.id
</select>
```

**优点：**
- **简单明了**：代码简洁，易于理解和维护，非常适合简单的查询。
- **类型安全**：DTO 类明确地定义了数据结构，使代码更具类型安全性。

**缺点：**
- **类爆炸问题**：每个不同的查询可能需要一个独立的 DTO 类，导致类数量剧增。
- **灵活性低**：无法处理复杂的表关系和嵌套对象，通常只适用于简单的查询。

**应用场景：**
- 简单查询，例如从单个表中获取数据，或者简单的联合查询。
- 查询结果结构较为固定，不涉及复杂的嵌套对象。

#### 三、总结与建议

| **场景**                              | **推荐方式**                      | **原因**                                                                                      |
|---------------------------------------|-----------------------------------|-----------------------------------------------------------------------------------------------|
| **复杂查询（多表联合、嵌套对象）**   | **ResultMap**                     | 灵活性高，可以处理复杂的映射和嵌套对象，避免类爆炸。                                               |
| **简单查询**                          | **DTO 直接映射**                  | 简单明了，便于维护和理解，尤其是在查询结构不复杂的情况下。                                           |
| **类型安全和固定结构的查询**         | **DTO 直接映射**                  | 类型安全，代码清晰，尤其适合有固定返回结构的 API。                                                  |

**补充建议：**
- 在实际项目中，可能需要结合使用 ResultMap 和 DTO 映射方式。对于复杂的查询，优先考虑使用 ResultMap 进行手动映射；对于简单查询和数据传输，使用 DTO 类能更好地保持代码的简洁性。
- 对于大型项目，可以使用 MyBatis Generator 或类似工具生成基础的 ResultMap 和 DTO 类，以减少手动编写的工作量，并确保一致性。

通过合理地选择和组合使用这些映射方式，可以使 MyBatis 在项目中更加高效和易于维护，满足不同场景下的开发需求。